<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #fdfdfd;
            color: #333;
        }
        .container {
            max-width: 1100px;
            margin: 30px auto;
            padding: 0 15px;
        }
        h1 {
            text-align: center;
            font-size: 32px;
            color: #2c3e50;
            margin-bottom: 20px;
        }
        form {
            text-align: center;
            margin-bottom: 30px;
        }
        input[type="file"] {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background: #fff;
            cursor: pointer;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: #5eaaa8;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            margin-left: 10px;
            transition: background 0.3s;
        }
        button:hover {
            background: #468f8c;
        }
        .stats-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        .card {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            flex: 1 1 calc(33.333% - 20px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .card-icon {
            font-size: 35px;
            color: #5eaaa8;
        }
        .card-content h3 {
            font-size: 18px;
            color: #555;
            margin-bottom: 5px;
        }
        .card-content p {
            font-size: 16px;
            margin: 0;
            color: #222;
        }
        .chart-container {
            margin-top: 40px;
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .chart-container h2 {
            text-align: center;
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
        }
        canvas {
            max-width: 100%;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <h1>Sales Dashboard</h1>

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="file" name="csv_file" required>
            <button type="submit">Upload</button>
        </form>
        <div style="display: flex;justify-content: center;align-items: center;gap: 0px;margin-bottom: 25px;">

            <button type="button" onclick="printdash()" style="background-color: #222;">Print</button>
            <button type="button" onclick="scrndash()" style="background-color: rgb(34, 93, 34);">Download</button>
        </div>

        <div class="stats-container">
            <div class="card">
                <i class="fas fa-dollar-sign card-icon"></i>
                <div class="card-content">
                    <h3>Total Sales</h3>
                    <p>${{ total_sales | floatformat:2 }}</p>
                </div>
            </div>
            <div class="card">
                <i class="fas fa-chart-line card-icon"></i>
                <div class="card-content">
                    <h3>Most Demanded Product</h3>
                    <p>{{ most_demanded_product }}</p>
                </div>
            </div>
            <div class="card">
                <i class="fas fa-users card-icon"></i>
                <div class="card-content">
                    <h3>Total Customers</h3>
                    <p>{{ total_customers }}</p>
                </div>
            </div>
            <div class="card">
                <i class="fas fa-box-open card-icon"></i>
                <div class="card-content">
                    <h3>Total Products Sold</h3>
                    <p>{{ total_products_sold }}</p>
                </div>
            </div>
            <div class="card">
                <i class="fas fa-user-tie card-icon"></i>
                <div class="card-content">
                    <h3>Top Paying Customer</h3>
                    <p>{{ top_paying_customer }}</p>
                </div>
            </div>
            <div class="card">
                <i class="fas fa-store card-icon"></i>
                <div class="card-content">
                    <h3>Branch with Highest Sales</h3>
                    <p>{{ highest_sales_branch }}</p>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <h2>Product Sales Distribution</h2>
            <canvas id="productChart"></canvas>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

    <script>
       const productChart = document.getElementById('productChart');
const productNames = JSON.parse('{{ product_names|escapejs }}');
const productQuantities = JSON.parse('{{ product_quantities|escapejs }}');

new Chart(productChart, {
    type: 'bar',
    data: {
        labels: productNames,
        datasets: [{
            label: 'Quantity Sold',
            data: productQuantities,
            backgroundColor: '#5eaaa8',
            borderColor: '#468f8c',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { display: false }
        },
        scales: {
            x: { title: { display: true, text: 'Product Names', color: '#555' } },
            y: { title: { display: true, text: 'Quantity Sold', color: '#555' } }
        }
    }
});

function printdash(){
    print()
}

function scrndash() {
    const targetDiv = document.querySelector('.container');
    
    html2canvas(targetDiv).then(canvas => {
        // Convert the canvas to an image
        const imgData = canvas.toDataURL('image/png');
        
        // Create a temporary link element
        const link = document.createElement('a');
        link.href = imgData;
        link.download = 'dashboard.png';
        
        // Trigger the download
        link.click();
    }).catch(err => {
        console.error('Failed to capture screenshot:', err);
    });
}
    </script>
</body>
</html>
