{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Segmentation Results - DataSegmentor</title>
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .container {
            background-color: #bebebe;
            background-image: radial-gradient(rgba(5, 5, 5, 0.171) 2px, transparent 0);
            background-size: 30px 30px;
            background-position: -5px -5px;
            min-height: 100vh;
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .result-header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, #1F4B97 0%, #1a3f80 100%);
            color: white;
            border-radius: 0 0 20px 20px;
            margin-bottom: 40px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .result-header h1 {
            font-size: 2.5em;
            margin-bottom: 15px;
        }

        .result-header p {
            font-size: 1.2em;
            max-width: 800px;
            margin: 0 auto;
            opacity: 0.9;
        }

        .result-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            margin-bottom: 40px;
        }

        .result-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        /* Footer Styles */
        .footer {
            background: #1a1a1a;
            color: #fff;
            padding: 60px 0 30px;
            margin-top: 50px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            padding: 0 20px;
        }

        .footer-section h3 {
            color: #fff;
            font-size: 1.2em;
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 10px;
        }

        .footer-section h3::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 50px;
            height: 2px;
            background: #1F4B97;
        }

        .footer-section p {
            color: #aaa;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .footer-links {
            list-style: none;
            padding: 0;
        }

        .footer-links li {
            margin-bottom: 12px;
        }

        .footer-links a {
            color: #aaa;
            text-decoration: none;
            transition: color 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .footer-links a:hover {
            color: #1F4B97;
        }

        .footer-social {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .social-icon {
            width: 35px;
            height: 35px;
            background: #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .social-icon:hover {
            background: #1F4B97;
            transform: translateY(-3px);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 30px;
            margin-top: 30px;
            border-top: 1px solid #333;
            color: #666;
        }

        .footer-bottom p {
            margin: 0;
            font-size: 0.9em;
        }

        .cluster-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .cluster-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .cluster-card:hover {
            transform: translateY(-5px);
        }

        .cluster-card h3 {
            color: #1F4B97;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .cluster-card h4 {
            color: #333;
            margin: 15px 0 10px;
        }

        .cluster-card ul {
            list-style: none;
            padding: 0;
        }

        .cluster-card li {
            margin: 5px 0;
            color: #666;
        }

        .summary-section {
            margin-top: 40px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .summary-section h2 {
            color: #1F4B97;
            margin-bottom: 20px;
        }

        .summary-section ul {
            list-style: none;
            padding: 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .summary-section li {
            background: #fff;
            padding: 5px 15px;
            border-radius: 20px;
            color: #666;
            font-size: 0.9em;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .result-section h2 {
            color: #1F4B97;
            margin: 30px 0 20px;
            font-size: 1.8em;
            text-align: center;
        }

        .toggle-container {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .switch {
            position: relative;
            display: inline-table;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #2196F3;
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        .toggle-label {
            margin-left: 10px;
        }

        .data-preview-container {
            display: block;
            width: 100%;
        }

        .preview-table {
            flex: 1;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            max-width: 100%;
            overflow-x: auto;
            box-sizing: border-box;
        }

        .table-responsive {
            overflow-x: auto;
            max-width: 100%;
        }

        .info-table {
            width: 100%;
            border-collapse: collapse;
        }

        .info-table th, .info-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
            color: #000000;
        }

        .info-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #000000;
        }

        .dataset-info {
            margin-top: 20px;
        }

        /* Dataset Description Styles */
        .description-stats {
            padding: 20px 0;
        }

        .stats-explanation {
            font-size: 1.1em;
            color: #000000;
            margin-bottom: 20px;
        }

        .stats-legend {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .stats-legend p {
            margin: 8px 0;
            color: #000000;
        }

        .stats-legend strong {
            color: #1F4B97;
        }

        /* Make description table text black */
        .description-stats .table {
            color: #000000;
        }

        .description-stats .table thead th {
            background-color: #f8f9fa;
            color: #000000;
            font-weight: 600;
        }

        .description-stats .table tbody td {
            background-color: white;
        }

        .mt-3 {
            margin-top: 1rem;
        }

        /* Data Table Styles */
        .table {
            width: 100%;
            margin-bottom: 1rem;
            background-color: transparent;
            border-collapse: collapse;
        }

        .table-striped tbody tr:nth-of-type(odd) {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .table-bordered {
            border: 1px solid #dee2e6;
        }

        .table-bordered th,
        .table-bordered td {
            border: 1px solid #dee2e6;
            padding: 0.75rem;
        }

        .table thead th {
            vertical-align: bottom;
            border-bottom: 2px solid #dee2e6;
            background-color: #f8f9fa;
            font-weight: 600;
            color: #000000;
        }

        .table tbody td {
            vertical-align: middle;
        }

        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            max-height: 400px;
            overflow-y: auto;
        }

        /* Make the table header sticky */
        .table thead th {
            position: sticky;
            top: 0;
            background-color: #f8f9fa;
            z-index: 1;
            color: #000000;
        }

        /* Dataset Cleaning Styles */
        .cleaning-status {
            margin-top: 40px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .status-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .status-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .status-card:hover {
            transform: translateY(-5px);
        }

        .status-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .status-header h3 {
            color: #1F4B97;
            font-size: 1.4em;
        }

        .status-icon {
            width: 30px;
            height: 30px;
            background: #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .status-icon:hover {
            background: #1F4B97;
            transform: translateY(-3px);
        }

        .status-content {
            margin-top: 10px;
        }

        .status-message {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .details-box {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .status-card.clean .status-icon {
            background: #4CAF50;
        }

        .status-card.warning .status-icon {
            background: #FFA500;
        }

        /* Cluster Analysis Styles */
        .optimal-k-info {
            margin: 30px 0;
        }

        .info-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            max-width: 300px;
            margin: 0 auto;
        }

        .optimal-k-value {
            margin-top: 15px;
        }

        .optimal-k-value .number {
            font-size: 3em;
            color: #1F4B97;
            font-weight: bold;
            display: block;
            margin-bottom: 10px;
        }

        .analysis-plots {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }

        .plot-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .plot-card h3 {
            color: #1F4B97;
            margin-bottom: 20px;
            text-align: center;
        }

        .plot-container {
            margin: 20px 0;
            text-align: center;
        }

        .plot-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }

        .plot-explanation {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .plot-explanation p {
            color: #666;
            margin: 0;
            font-size: 0.95em;
            line-height: 1.5;
        }

        .cluster-visualization {
            margin-top: 40px;
        }

        .cluster-visualization h3 {
            color: #1F4B97;
            margin-bottom: 20px;
            text-align: center;
        }

        .analysis-content {
            font-size: 1.1em;
            line-height: 1.6;
        }

        .analysis-content h4 {
            color: #2c3e50;
            margin-top: 1.5em;
            margin-bottom: 1em;
            font-weight: 600;
        }

        .analysis-content ul {
            list-style-type: none;
            padding-left: 1.5em;
        }

        .analysis-content li {
            margin-bottom: 0.5em;
            position: relative;
        }

        .analysis-content li:before {
            content: "•";
            color: #3498db;
            font-weight: bold;
            position: absolute;
            left: -1em;
        }

        .analysis-content strong {
            color: #2980b9;
        }

        /* AI Analysis Styling */
        .ai-analysis-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .ai-analysis-content {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #2c3e50;
        }

        .ai-analysis-content h4 {
            color: #1F4B97;
            margin-top: 2rem;
            margin-bottom: 1.2rem;
            font-weight: 600;
            font-size: 1.4rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e9ecef;
        }

        /* Cluster Information Styling */
        .cluster-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .cluster-info h5 {
            color: #1F4B97;
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cluster-info h5::before {
            content: "🎯";
            font-size: 1.2em;
        }

        .cluster-info ul {
            list-style: none;
            padding-left: 0;
            margin-bottom: 0;
        }

        .cluster-info li {
            margin-bottom: 10px;
            padding-left: 25px;
            position: relative;
        }

        .cluster-info li::before {
            content: "•";
            color: #1F4B97;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        /* Segmentation Section Styling */
        .segmentation-section {
            margin-top: 30px;
        }

        .segmentation-section h4 {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .segmentation-section ul {
            list-style: none;
            padding-left: 0;
        }

        .segmentation-section li {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-left: 4px solid #1F4B97;
        }

        .segmentation-section strong {
            color: #1F4B97;
            font-weight: 600;
        }

        /* Summary Section Styling */
        .summary-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }

        .summary-section h4 {
            border-bottom: none;
            margin-top: 0;
        }

        .summary-section p {
            margin-bottom: 0;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .ai-analysis-content {
                font-size: 1rem;
            }
            
            .ai-analysis-content h4 {
                font-size: 1.2rem;
            }

            .ai-analysis-container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="contain">
            <div class="navbar">
                <div class="sideimage">
                    <h4 style="margin: 20px;">Data<span>Segmentor</span></h4>
                </div>
                <center>
                    <div class="centercontent">
                        <a href="{% url 'home' %}"><h4>Home</h4></a>
                        <a href="{% url 'prediction' %}"><h4>Customer Acquisition Prediction</h4></a>
                        <a href="{% url 'segmentation' %}"><h4>Data Segmentation</h4></a>
                        <a href="{% url 'help' %}"><h4>Help</h4></a>
                        <a href="{% url 'contact' %}"><h4>Contact</h4></a>
                    </div>
                </center>
                <div class="sidecontent">
                    {% if request.user.is_authenticated %}
                    <a href="{% url 'logout' %}">
                        <button class="Logout">Logout</button>
                    </a>
                    {% else %}
                    <a href="{% url 'login' %}">
                        <button class="login">Login</button>
                    </a>
                    {% endif %}
                </div>
            </div>

            <div class="result-header">
                <h1>Data Segmentation Results</h1>
                <p>Analysis and insights from your customer data segmentation</p>
            </div>

            <div class="result-container">
                <!-- Data Preview Section -->
                <div class="result-section">
                    <h2>Data Preview</h2>
                    <div class="toggle-container">
                        <label class="switch">
                            <input type="checkbox" id="dataToggle">
                            <span class="slider round"></span>
                        </label>
                        <span class="toggle-label">Toggle between Head/Tail</span>
                    </div>
                    
                    <div class="data-preview-container">
                        <div id="headData" class="preview-table">
                            <h3>First 5 Rows</h3>
                            <div class="table-responsive">
                                {{ head_data|safe }}
                            </div>
                        </div>
                        <div id="tailData" class="preview-table" style="display: none;">
                            <h3>Last 5 Rows</h3>
                            <div class="table-responsive">
                                {{ tail_data|safe }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dataset Information Section -->
                <div class="result-section">
                    <h2>Dataset Information</h2>
                    <div class="dataset-info">
                        <table class="info-table">
                            <tr>
                                <th>Total Rows</th>
                                <th>Total Features</th>
                                <th>Null Values</th>
                                <th>Duplicate Rows</th>
                            </tr>
                            <tr>
                                <td>{{ total_rows }}</td>
                                <td>{{ total_features }}</td>
                                <td>{{ null_values }}</td>
                                <td>{{ duplicate_rows }}</td>
                            </tr>
                        </table>
                    </div>
                </div>

                <!-- Dataset Description Section -->
                <div class="result-section">
                    <h2>Dataset Description</h2>
                    <div class="description-stats">
                        <p class="stats-explanation">Statistical summary of numerical features:</p>
                        <div class="table-responsive">
                            {{ description_stats|safe }}
                        </div>
                        <div class="stats-legend mt-3">
                            <p><strong>count:</strong> Number of non-null values</p>
                            <p><strong>mean:</strong> Average value</p>
                            <p><strong>std:</strong> Standard deviation (measure of spread)</p>
                            <p><strong>min:</strong> Minimum value</p>
                            <p><strong>25%:</strong> First quartile (25th percentile)</p>
                            <p><strong>50%:</strong> Median (50th percentile)</p>
                            <p><strong>75%:</strong> Third quartile (75th percentile)</p>
                            <p><strong>max:</strong> Maximum value</p>
                        </div>
                    </div>
                </div>

                <!-- Dataset Cleaning Section -->
                <div class="result-section">
                    <h2>Dataset Cleaning Status</h2>
                    <div class="cleaning-status">
                        <div class="status-cards">
                            <!-- Null Values Card -->
                            <div class="status-card {% if not null_info.has_nulls %}clean{% endif %}">
                                <div class="status-header">
                                    <h3>Null Values</h3>
                                    {% if not null_info.has_nulls %}
                                        <span class="status-icon">
                                            <i class="fas fa-check-circle"></i>
                                        </span>
                                    {% else %}
                                        <span class="status-icon warning">
                                            <i class="fas fa-exclamation-circle"></i>
                                        </span>
                                    {% endif %}
                                </div>
                                <div class="status-content">
                                    {% if not null_info.has_nulls %}
                                        <p class="status-message">No null values found in the dataset.</p>
                                    {% else %}
                                        <p class="status-message">Found {{ null_info.total_nulls }} null values:</p>
                                        <div class="details-box">
                                            {% for column, count in null_info.columns_with_nulls.items %}
                                                <p><strong>{{ column }}:</strong> {{ count }} nulls</p>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Duplicate Values Card -->
                            <div class="status-card {% if not duplicate_info.has_duplicates %}clean{% endif %}">
                                <div class="status-header">
                                    <h3>Duplicate Rows</h3>
                                    {% if not duplicate_info.has_duplicates %}
                                        <span class="status-icon">
                                            <i class="fas fa-check-circle"></i>
                                        </span>
                                    {% else %}
                                        <span class="status-icon warning">
                                            <i class="fas fa-exclamation-circle"></i>
                                        </span>
                                    {% endif %}
                                </div>
                                <div class="status-content">
                                    {% if not duplicate_info.has_duplicates %}
                                        <p class="status-message">No duplicate rows found in the dataset.</p>
                                    {% else %}
                                        <p class="status-message">Found {{ duplicate_info.total_duplicates }} duplicate rows in the dataset.</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="result-section">
                    <h2>Cluster Analysis</h2>
                    
                    <!-- Optimal K Value -->
                    <div class="optimal-k-info">
                        <div class="info-card">
                            <h3>Optimal Number of Clusters</h3>
                            <div class="optimal-k-value">
                                <span class="number">{{ optimal_k }}</span>
                                <p>Based on maximum Silhouette Score</p>
                            </div>
                        </div>
                    </div>

                    <!-- Analysis Plots -->
                    <div class="analysis-plots">
                        <!-- WCSS Plot -->
                        <div class="plot-card">
                            <h3>Elbow Method</h3>
                            <div class="plot-container">
                                <img src="data:image/png;base64,{{ wcss_plot }}" alt="Elbow Method Plot">
                            </div>
                            <div class="plot-explanation">
                                <p>The elbow method helps determine the optimal number of clusters by plotting the Within-Cluster Sum of Squares (WCSS) against different values of k. The "elbow" point indicates the optimal number of clusters.</p>
                            </div>
                        </div>

                        <!-- Silhouette Score Plot -->
                        <div class="plot-card">
                            <h3>Silhouette Score Analysis</h3>
                            <div class="plot-container">
                                <img src="data:image/png;base64,{{ silhouette_plot }}" alt="Silhouette Score Plot">
                            </div>
                            <div class="plot-explanation">
                                <p>The Silhouette Score measures how similar an object is to its own cluster compared to other clusters. Higher scores indicate better-defined clusters. The optimal number of clusters is where the Silhouette Score peaks.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Cluster Visualization -->
                    <div class="cluster-visualization">
                        <h3>Cluster Visualization</h3>
                        <form method="post" class="mb-4" id="clusterForm" style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                            {% csrf_token %}
                            <div class="form-group" style="margin: 0;">
                                <label for="n_clusters" style="margin-right: 10px;">Number of Clusters:</label>
                                <select name="n_clusters" id="n_clusters" class="form-control" style="width: 100px; display: inline-block;">
                                    {% for i in "23456789"|make_list %}
                                        <option value="{{ i }}" {% if n_clusters == i|add:"0" %}selected{% endif %}>{{ i }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <label for="color_scale" style="margin-right: 10px;">Color Scale:</label>
                                <select name="color_scale" id="color_scale" class="form-control" style="width: 150px; display: inline-block;">
                                    {% for scale in color_scales %}
                                        <option value="{{ scale }}">{{ scale|title }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </form>
                        
                        <div class="plot-container">
                            <h4>2D Visualization</h4>
                            <div id="cluster2dPlot" style="width: 100%; height: 500px;"></div>
                            <div class="plot-explanation">
                                <p>2D visualization of customer segments using PCA (Principal Component Analysis) for dimensionality reduction. Each color represents a different customer segment.</p>
                            </div>
                        </div>

                        <div class="plot-container" style="margin-top: 30px;">
                            <h4>3D Visualization</h4>
                            <div id="cluster3dPlot" style="width: 100%; height: 600px;"></div>
                            <div class="plot-explanation">
                                <p>3D visualization of customer segments using PCA, providing an additional dimension for better cluster separation visualization. Use this view to identify clusters that might not be apparent in the 2D visualization.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Analysis Section -->
                <div class="result-section">
                    <h2>AI-Powered Cluster Analysis</h2>
                    <div class="ai-analysis-container">
                        {% if ai_analysis %}
                            <div class="ai-analysis-content formatted-ai-analysis" id="aiAnalysisOutput" style="background: #f8f9fa; border-radius: 12px; padding: 28px 32px; font-size: 1.15rem; line-height: 2; color: #222; box-shadow: 0 2px 8px rgba(31,75,151,0.07); border: 1.5px solid #e0e7ef; font-family: 'Segoe UI', 'Poppins', Arial, sans-serif; overflow-x: auto;">
                                <noscript><pre>{{ ai_analysis }}</pre></noscript>
                            </div>
                            <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
                            <script>
                                document.addEventListener('DOMContentLoaded', function() {
                                    var aiRaw = "{{ ai_analysis|escapejs }}";
                                    document.getElementById('aiAnalysisOutput').innerHTML = marked.parse(aiRaw);
                                });
                            </script>
                        {% else %}
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>No AI analysis available for this dataset.
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>About DataSegmentor</h3>
                <p>Empowering businesses with advanced analytics and machine learning solutions for better customer insights and data-driven decisions.</p>
                <div class="footer-social">
                    <a href="#" class="social-icon"><i class="fab fa-linkedin-in"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul class="footer-links">
                    <li><a href="{% url 'home' %}"><i class="fas fa-chevron-right"></i> Home</a></li>
                    <li><a href="{% url 'prediction' %}"><i class="fas fa-chevron-right"></i> Customer Acquisition</a></li>
                    <li><a href="{% url 'segmentation' %}"><i class="fas fa-chevron-right"></i> Data Segmentation</a></li>
                    <li><a href="{% url 'help' %}"><i class="fas fa-chevron-right"></i> Help Center</a></li>
                    <li><a href="{% url 'contact' %}"><i class="fas fa-chevron-right"></i> Contact Us</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Contact Info</h3>
                <ul class="footer-links">
                    <li>
                        <a href="#"><i class="fas fa-map-marker-alt"></i> 3301 Analytics Street, Data City, DC 4545</a>
                    </li>
                    <li>
                        <a href="tel:+919876543210"><i class="fas fa-phone"></i> +91 9876543210</a>
                    </li>
                    <li>
                        <a href="mailto:support@datasegmentor.com"><i class="fas fa-envelope"></i> support@datasegmentor.com</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; {% now "Y" %} DataSegmentor. All rights reserved.</p>
        </div>
    </footer>
    <script src="{% static 'js/index.js'%}"></script>
    <script>
        document.getElementById('dataToggle').addEventListener('change', function() {
            const headData = document.getElementById('headData');
            const tailData = document.getElementById('tailData');
            
            if (this.checked) {
                headData.style.display = 'none';
                tailData.style.display = 'block';
            } else {
                headData.style.display = 'block';
                tailData.style.display = 'none';
            }
        });
    </script>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <script>
        // Initial plot data
        const plotData2D = {{ plot_data_2d|safe }};
        const plotData3D = {{ plot_data_3d|safe }};

        // Create initial plots
        Plotly.newPlot('cluster2dPlot', plotData2D.data, plotData2D.layout, {
            responsive: true,
            displayModeBar: true,
            modeBarButtonsToAdd: ['toImage'],
            modeBarButtonsToRemove: ['lasso2d']
        });

        Plotly.newPlot('cluster3dPlot', plotData3D.data, plotData3D.layout, {
            responsive: true,
            displayModeBar: true,
            modeBarButtonsToAdd: ['toImage'],
            modeBarButtonsToRemove: ['lasso2d']
        });

        // Function to update plots
        async function updatePlots() {
            const formData = new FormData(document.getElementById('clusterForm'));
            const response = await fetch('{% url "update_clusters" %}', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': formData.get('csrfmiddlewaretoken')
                }
            });
            
            const data = await response.json();
            
            // Update 2D plot
            Plotly.react('cluster2dPlot', data.plot_data_2d.data, data.plot_data_2d.layout);
            
            // Update 3D plot
            Plotly.react('cluster3dPlot', data.plot_data_3d.data, data.plot_data_3d.layout);
        }

        // Add event listeners for real-time updates
        document.getElementById('n_clusters').addEventListener('change', updatePlots);
        document.getElementById('color_scale').addEventListener('change', updatePlots);
    </script>
</body>
</html> 